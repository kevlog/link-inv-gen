<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Undangan Generator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet" />
    <style>
      #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        z-index: -1;
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-white min-h-screen flex items-center justify-center relative"
  >
    <div id="particles-js"></div>

    <div
      class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl shadow-xl p-8 w-full max-w-xl"
      data-aos="fade-up"
    >
      <h2 class="text-2xl font-bold mb-6 text-center text-white">
        üéâ Generator Link Undangan
      </h2>

      <!-- Basic URL -->
      <label class="block mb-2 font-medium">Basic URL</label>
      <input
        type="text"
        id="basicUrl"
        placeholder="contoh: hikvn.my.id/inv/kebun"
        class="w-full px-4 py-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300"
      />

      <!-- Separator -->
      <label class="block mt-4 mb-2 font-medium">Separator</label>
      <select
        id="separator"
        onchange="handleSeparatorChange()"
        class="w-full px-4 py-2 rounded bg-white bg-opacity-20 text-white"
      >
        <option value="?to=">?to=</option>
        <option value="?ke=">?ke=</option>
        <option value="?guest=">?guest=</option>
        <option value="?nama=">?nama=</option>
        <option value="custom">üîß Lainnya / Custom...</option>
      </select>
      <input
        type="text"
        id="customSeparator"
        class="hidden mt-2 w-full px-4 py-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300"
        placeholder="Isi separator custom, contoh: ?undangan="
      />

      <!-- Input manual -->
      <label class="block mt-4 mb-2 font-medium">Nama Tamu (Manual)</label>
      <input
        type="text"
        id="guestName"
        placeholder="contoh: kevin"
        class="w-full px-4 py-2 rounded bg-white bg-opacity-20 text-white placeholder-gray-300"
      />

      <!-- Upload file -->
      <label class="block mt-4 mb-2 font-medium"
        >Upload File Daftar Nama (.txt)</label
      >
      <input
        type="file"
        id="guestFile"
        accept=".txt"
        class="w-full text-white bg-opacity-20"
      />

      <!-- Tombol -->
      <button
        onclick="generateLink()"
        class="mt-6 w-full py-2 px-4 bg-pink-500 hover:bg-pink-600 rounded font-semibold transition duration-200"
      >
        Generate Link
      </button>

      <!-- Output -->
      <div class="mt-6 text-sm break-words text-white" id="output"></div>
      <div class="flex justify-center">
        <a
          id="downloadLink"
          href="#"
          download="undangan.txt"
          class="hidden mt-4 w-full max-w-xs inline-block py-2 px-4 bg-green-500 hover:bg-green-600 rounded text-center"
        >
          ‚¨áÔ∏è Download Link (.txt)
        </a>
      </div>
    </div>

    <!-- Script -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
      AOS.init();

      particlesJS("particles-js", {
        particles: {
          number: { value: 60, density: { enable: true, value_area: 800 } },
          color: { value: "#ffffff" },
          shape: { type: "circle" },
          opacity: { value: 0.5 },
          size: { value: 3 },
          line_linked: {
            enable: true,
            distance: 150,
            color: "#ffffff",
            opacity: 0.4,
            width: 1,
          },
          move: { enable: true, speed: 2 },
        },
        interactivity: {
          detect_on: "canvas",
          events: { onhover: { enable: true, mode: "repulse" } },
          modes: { repulse: { distance: 100 } },
        },
        retina_detect: true,
      });

      function handleSeparatorChange() {
        const sep = document.getElementById("separator").value;
        const customInput = document.getElementById("customSeparator");
        customInput.classList.toggle("hidden", sep !== "custom");
      }

      function generateLink() {
        const output = document.getElementById("output");
        const downloadLink = document.getElementById("downloadLink");
        output.innerHTML = "";
        downloadLink.classList.add("hidden");

        let base = document.getElementById("basicUrl").value.trim();
        const separator = document.getElementById("separator").value;
        const customSep = document
          .getElementById("customSeparator")
          .value.trim();
        const name = document.getElementById("guestName").value.trim();
        const file = document.getElementById("guestFile").files[0];

        const sep = separator === "custom" ? "/?" + customSep + "=" : separator;

        if (!/^https?:\/\//i.test(base)) {
          base = "https://" + base;
        }

        if (!sep || !base) {
          output.innerHTML =
            "<b class='text-red-400'>Mohon isi Basic URL & Separator.</b>";
          return;
        }

        // Jika pakai file upload
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const lines = e.target.result
              .split(/\r?\n/)
              .filter((l) => l.trim() !== "");
            const links = lines.map(
              (n) => `${base}${sep}${encodeURIComponent(n.trim())}`
            );
            output.innerHTML = `
            <p class="mb-2 font-semibold text-pink-300">Total ${
              links.length
            } link berhasil dibuat:</p>
            <ul class="list-disc pl-6">${links
              .slice(0, 5)
              .map(
                (l) =>
                  `<li><a href="${l}" target="_blank" class="underline text-blue-300">${l}</a></li>`
              )
              .join("")}</ul>
            ${
              links.length > 5
                ? '<p class="text-sm text-gray-400 mt-2">...dan lainnya.</p>'
                : ""
            }
          `;

            // Buat file download
            const blob = new Blob([links.join("\n")], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.classList.remove("hidden");
          };
          reader.readAsText(file);
        }

        // Jika pakai input nama manual
        else if (name) {
          const finalUrl = `${base}${sep}${encodeURIComponent(name)}`;
          output.innerHTML = `
          <p class="mb-1 font-medium text-pink-300">Link Undangan:</p>
          <a href="${finalUrl}" target="_blank" class="underline text-blue-300">${finalUrl}</a>
        `;
        } else {
          output.innerHTML =
            "<b class='text-red-400'>Masukkan nama tamu atau unggah file .txt</b>";
        }
      }
    </script>
  </body>
</html>
